# 5.5 质因子分解

所谓质因子分解就是将一个正整数 n 写成一个或多个质数的乘积的形式，例如 6 = 2 x 3, 180 = 2 x 2 x 3 x 3 x 5。或者也可以写成指数的形式。

由于最后都要归结到若干不同质数的乘积，因此不妨先把素数表打印出来。由于 1 本身不是素数，因此它没有质因子，下面的讲解是针对大于 1 的正整数来讲的， **如果有些题目中要对 1 进行处理，那么视条件而定进行特判处理**。

由于每个质因子都可以不止出现一次，因此不妨定义结构体 factor，用来存放质因子及其个数，如果所示：

```cpp
struct factor{
    int x, cnt;    //x为质因子，cnt为其个数
}fac[10];    //fac[]数组存放的就是给定的正整数n的所有质因子。
```

考虑到 `2x3x5x7x11x19x23x29` 就已经超过了 `int` 范围，因此对一个 int 型范围的数来说，**fac数组的大小只需开到 10 就可以了**。

对于一个正整数 n 来说，如果它存在 [2, n] 范围内的质因子，要么这些质因子全部小于等于 sqrt(n)，要么只存在一个大于 sqrt(n) 的质因子，而其余质因子全部小于等于 sqrt(n)。这为质因子分解提供了一个很好的思路：

1. 枚举 1~sqrt(n) 范围内的所有质因子 p，判断 p 是否是 n 的因子。
   - 如果 p 是 n 的因子，那么给 fac 数组中增加质因子 p，并初始化其个数为 0.然后只要 p 还是 n 的因子，就让 n 不断除以 p，每次操作令 p 的个数加 1，直到 p 不再是 n 的因子为止。
   - 如果 p 不是 n 的因子，就直接跳过。

2. 如果在上面步骤后 n 仍然大于 1。就说明 n 有且仅有一个大于 sqrt(n) 的质因子(有可能是 n 本身)，这是需要这个质因子加入 fac数组，并令其个数为 1.

```cpp
if(n % prime[i] == 0){    //如果 prime[i] 是 n 的因子
    fac[num].x = prime[i];    //记录该因子
    fac[num].cnt = 0;
    while(n % prime[i] == 0){    //计算出质因子 prime[i] 的个数
        fac[num].cnt++;
        n /= prime[i];
    }
    num++;    //不同质因子个数加1
}
```

```cpp
if(n != 1){    //如果无法被根号 n 以内的质因子除尽
    fac[num].x = n;    //那么一定有大于根号 n 的质因子
    fac[num++].cnt = 1;
}
```

至此，fac数组中存放的就是质因子分解的结果，时间复杂度是 O(sqrt(n))。
